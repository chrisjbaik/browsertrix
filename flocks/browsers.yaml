name: browsers
auto_remove: false

volumes:
  tmpdir: '/tmp/.X11-unix'
  '/Users/ilya/work/browsertrix/wa2/': '/webarchive'

containers:
  - name: pywb
    image: webrecorder/browsertrix-pywb

    external_network: '${BROWSER_NET}'

    environment:
      COLL: ${COLL}

  - name: xserver
    image: oldwebtoday/remote-desktop-server
    external_network: '${BROWSER_NET}'
    ports:
      vnc-port: 6080
      cmd-port: 6082
      ice-tcp-port: 10235
      ice-udp-port: '10235/udp'

    environment:
      IDLE_TIMEOUT: '${IDLE_TIMEOUT}'
      WEBRTC_TURN_REST_AUTH_SECRET: '${WEBRTC_TURN_REST_AUTH_SECRET}'

  - name: browser
    image: oldwebtoday/base-browser
    image_label: wr.name
    set_user_params: true
    external_network: '${BROWSER_NET}'

    environment:
      DISPLAY: ':99'
      PULSE_SERVER: '/tmp/.X11-unix/pulse-socket'

      #default to no proxy, set by crawler
      PROXY_HOST: ''
      PROXY_PORT: '8080'
      PROXY_CA_URL: '' #http://wsgiprox/download/pem'
      PROXY_CA_FILE: '' #/tmp/proxy-ca.pem'

  - name: autobrowser
    image: webrecorder/simple-driver

    external_network: '${MAIN_NET}'

    environment:
      BROWSER_HOST: 'browser'
      REDIS_URL: 'redis://redis:6379/0'
      TAB_TYPE: 'CrawlerTab'


